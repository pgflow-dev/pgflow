---
allowed-tools: Read, Edit, Grep, Bash(git mv:*), Bash(git show:*), Bash(git ls-tree:*), Bash(mkdir -p:*), Bash(ls:*), Bash(tree:*), Bash(pnpm nx build website)
description: Move documentation files with git history, link updates, sidebar, overview pages, and redirects
argument-hint: <source-file-or-description>
---

You are tasked with moving or renaming documentation files with proper git history preservation, link updates, and redirect configuration.

## Context

Documentation root: `pkgs/website/src/content/docs/`

Current directory structure:
<structure>
!`tree pkgs/website/src/content/docs/ -L 2 -d`
</structure>

Redirects config location: `pkgs/website/redirects.config.mjs`

User request:
<request>
$ARGUMENTS
</request>

## Multi-Step Process

### Step 1: Parse Move Request

Determine:
1. **Source file(s)**: Which file(s) to move
2. **Destination**: Where to move them
3. **Reason**: Why this move (helps with redirect reasoning)

**If source unclear:**
- Search for matching files
- Present options to user
- WAIT for confirmation

**If destination unclear:**
- Suggest destination based on content type and Diataxis
- Present suggestion to user
- WAIT for confirmation

Present plan:
```markdown
## Move Plan

**Source:**      pkgs/website/src/content/docs/[old-path]
**Destination:** pkgs/website/src/content/docs/[new-path]
**Reason:**      [brief explanation]

**Old URL:** /[old-path]/
**New URL:** /[new-path]/
```

WAIT for user approval.

### Step 2: Find All References

Search for all references to the old path:

```bash
# Documentation links
grep -r "[old-path]" pkgs/website/src/content/docs/ --include="*.mdx"
grep -r "/[old-path]/" pkgs/website/src/content/docs/ --include="*.mdx"
grep -r "[old-path]/#" pkgs/website/src/content/docs/ --include="*.mdx"

# Sidebar
grep -n "[old-path]" pkgs/website/astro.config.mjs

# Overview pages
grep -r "[old-path]" pkgs/website/src/content/docs/**/index.mdx

# LinkCards
grep -r "href=\"/[old-path]" pkgs/website/src/content/docs/ --include="*.mdx"
```

Present findings:
- Documentation files: [count]
- Sidebar entries: [count]
- Overview pages: [count]
- LinkCards: [count]

### Step 3: Create Destination Directory (if needed)

If destination directory doesn't exist:
```bash
mkdir -p pkgs/website/src/content/docs/[destination-dir]/
```

### Step 4: Move File with Git

Use `git mv` to preserve history:
```bash
git mv pkgs/website/src/content/docs/[old-path] pkgs/website/src/content/docs/[new-path]
```

Confirm move successful.

### Step 5: Update All References

Update all references to the moved file:

**Documentation links:**
- For each file: Read → Replace `[old-path]` with `[new-path]` → Edit
- Patterns: `[text](/old-path/)`, `href="/old-path/"`, anchor links

**Sidebar navigation:**
- If manually listed in astro.config.mjs: Update `link` and `label`
- If autogenerated: No action needed

**Overview pages (index.mdx):**
- Check parent directory index files
- Update paths and titles in descriptions

**LinkCards:**
- Update `href="/old-path/"` to `href="/new-path/"`
- Update card title if page title changed

### Step 6: Add Redirect

Add redirect to `pkgs/website/redirects.config.mjs`:
```javascript
'/old-path/': '/new-path/', // [Brief reason]
```

### Step 7: Verify

Run verification checks:

```bash
# File exists
ls -la pkgs/website/src/content/docs/[new-path]

# No remaining references (should be empty)
grep -r "[old-path]" pkgs/website/src/content/docs/ --include="*.mdx"

# Redirect added
grep "[old-path]" pkgs/website/redirects.config.mjs

# Build passes
pnpm nx build website
```

### Step 8: Summary

Present results:

```markdown
## Move Complete: [filename]

✓ File moved with git history
✓ [count] links updated
✓ Sidebar/index/LinkCards updated
✓ Redirect added
✓ Build passed

**Suggested commit:**
```
refactor(docs): move [filename] to [new-location]

Move: [old-path] → [new-path]
Update [count] links, add redirect

Reason: [brief explanation]
```

Review with `git status` and commit manually.
```

## Common Patterns

**Reorganization:**
```
FROM: docs/how-to/create-tasks.mdx
TO:   docs/develop/authoring/create-tasks.mdx
```

**Content type correction:**
```
FROM: docs/get-started/understanding-flows.mdx
TO:   docs/concepts/flows/understanding-flows.mdx
```

**Grouping:**
```
FROM: docs/reference/configuration.mdx
TO:   docs/reference/configuration/flow-config.mdx
Note: May need index.mdx in new directory
```

## Batch Moves

For multiple files:
1. Present plan: List all moves, counts for files/redirects/links → WAIT for approval
2. Execute: Move all with `git mv`, update all references, add all redirects
3. Verify: Check moves, references, redirects, build

## Important Reminders

- **Always use git mv** - preserves file history
- **Always add redirects** - never break old URLs
- **Update ALL references** - links, sidebar, index.mdx, LinkCards
- **Check sidebar** - update both path and label if manually listed
- **Update overview pages** - index.mdx files often reference moved pages
- **Update LinkCards** - both href and title text
- **Test build** - catch broken links early
- **No automatic commits** - user reviews and commits manually

## Error Handling

- **File exists:** Ask user to overwrite or rename
- **Build fails:** Show error, offer to help identify cause
- **Too many links (>20):** Warn and confirm before proceeding

## Special Cases

- **index.mdx:** Affects parent URL, may need multiple redirects
- **Anchors:** Update `/old-path/#section` → `/new-path/#section`
- **Existing dirs:** Check for naming conflicts

