{
	"name": "demo",
	"$schema": "../../node_modules/nx/schemas/project-schema.json",
	"projectType": "application",
	"sourceRoot": "apps/demo/src",
	"targets": {
		"dev": {
			"executor": "nx:run-commands",
			"dependsOn": ["^build"],
			"options": {
				"command": "vite dev",
				"cwd": "apps/demo"
			}
		},
		"dev:remote": {
			"executor": "nx:run-commands",
			"dependsOn": ["^build"],
			"options": {
				"command": "vite dev --host 0.0.0.0",
				"cwd": "apps/demo"
			}
		},
		"build": {
			"executor": "nx:run-commands",
			"options": {
				"command": "vite build",
				"cwd": "apps/demo"
			},
			"outputs": ["{projectRoot}/.svelte-kit"],
			"inputs": [
				"{projectRoot}/wrangler.toml",
				{
					"env": "VITE_SUPABASE_URL"
				},
				{
					"env": "VITE_SUPABASE_ANON_KEY"
				}
			]
		},
		"preview": {
			"executor": "nx:run-commands",
			"options": {
				"command": "vite preview",
				"cwd": "apps/demo"
			},
			"dependsOn": ["build"]
		},
		"sync-edge-deps": {
			"executor": "nx:run-commands",
			"dependsOn": ["core:build", "dsl:build"],
			"options": {
				"command": "./scripts/sync-edge-deps.sh",
				"cwd": "apps/demo"
			}
		},
		"test": {
			"executor": "nx:run-commands",
			"options": {
				"command": "deno test --allow-env --allow-net tests/",
				"cwd": "apps/demo/supabase/functions/article_flow_worker"
			}
		},
		"ensure-ci-environment": {
			"executor": "nx:run-commands",
			"options": {
				"command": "node -e \"if (!process.env.CI) throw new Error('This target must run in CI environment')\""
			}
		},
		"deploy": {
			"executor": "nx:run-commands",
			"cache": false,
			"local": true,
			"dependsOn": ["build", "ensure-ci-environment"],
			"inputs": ["{projectRoot}/wrangler.toml"],
			"options": {
				"cwd": "apps/demo",
				"command": "wrangler deploy --env production"
			}
		},
		"validate:preview": {
			"executor": "nx:run-commands",
			"options": {
				"cwd": "apps/demo",
				"command": "./scripts/validate-preview-env.sh"
			}
		},
		"build:preview": {
			"executor": "nx:run-commands",
			"dependsOn": ["validate:preview", "^build"],
			"inputs": ["{projectRoot}/.env.preview", "{projectRoot}/wrangler.toml"],
			"outputs": ["{projectRoot}/.svelte-kit"],
			"options": {
				"cwd": "apps/demo",
				"command": "vite build --mode preview"
			}
		},
		"deploy:preview:webapp": {
			"executor": "nx:run-commands",
			"cache": false,
			"local": true,
			"dependsOn": ["sync-edge-deps", "build:preview"],
			"inputs": ["{projectRoot}/wrangler.toml"],
			"options": {
				"cwd": "apps/demo",
				"command": "./scripts/deploy-preview.sh ${PREVIEW_NAME:-pr-${PR_NUMBER:-preview}}"
			}
		},
		"deploy:preview:db": {
			"executor": "nx:run-commands",
			"cache": false,
			"dependsOn": ["validate:preview"],
			"options": {
				"cwd": "apps/demo",
				"command": "./scripts/db-reset-preview.sh"
			}
		},
		"deploy:preview:functions": {
			"executor": "nx:run-commands",
			"cache": false,
			"dependsOn": ["deploy:preview:db", "sync-edge-deps"],
			"options": {
				"cwd": "apps/demo",
				"command": "./scripts/functions-deploy-preview.sh"
			}
		},
		"deploy:preview": {
			"executor": "nx:run-commands",
			"cache": false,
			"dependsOn": ["deploy:preview:functions", "deploy:preview:webapp"],
			"options": {
				"command": "echo 'âœ… Full preview deployment complete!'"
			}
		}
	}
}
