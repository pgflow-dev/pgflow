---
title: Configuration
prev:
  link: /edge-worker/install-edge-worker
next:
  link: /edge-worker/observability
---

import { Aside, Steps } from "@astrojs/starlight/components";

You can pass an optional configuration object as the second argument to `EdgeWorker.start()`
to tweak the worker's behavior.

<Aside title="Zero Configuration" type="tip">
Edge Worker comes with sensible defaults for all configuration options.

You only need to provide a handler function:

```ts
EdgeWorker.start(console.log);
```
</Aside>

### Default configuration

```typescript
EdgeWorker.start(handler, {
  // name of the queue to poll for messages
  queueName: 'tasks',

  // how many tasks are processed at the same time
  maxConcurrent: 10,

  // how many connections to the database are opened
  maxPgConnections: 4,

  // in-worker polling interval
  maxPollSeconds: 5,

  // in-database polling interval
  pollIntervalMs: 200,

  // how long to wait before retrying a failed job
  retryDelay: 5,

  // how many times to retry a failed job
  retryLimit: 5,

  // how long a job is invisible after reading
  // if not successful, will reappear after this time
  visibilityTimeout: 3,
});
```

## Queue and polling

### `queueName`
**Type:** `string`
**Default:** `'tasks'`

The name of the PGMQ queue to listen to for messages.

<Aside title="You don't need to create queues manually" type="tip">
The worker will automatically create a logged, non-partitioned queue
with configured name during startup if it does not exist.
</Aside>

```ts
EdgeWorker.start(handler, {
  queueName: 'my_custom_queue'
});
```

### `maxPollSeconds`
**Type:** `number`
**Default:** `5`

Amount of seconds to wait for a message to be available in the queue.

```ts
EdgeWorker.start(handler, {
  maxPollSeconds: 5 // Long-poll for 5 seconds waiting for a message
});
```

### `pollIntervalMs`
**Type:** `number`
**Default:** `200`

The interval (in milliseconds) between database polling attempts by `pgmq.read_with_poll`.
The default value is suitable for most use cases.

<Aside type="caution">
  This value should be lower than the `maxPollSeconds`.
</Aside>


```ts
EdgeWorker.start(handler, {
  pollIntervalMs: 300 // Poll every 300ms
});
```

## Retries

### `retryDelay`
**Type:** `number`
**Default:** `5`

Amount of seconds to wait between retry attempts.

```ts
EdgeWorker.start(handler, {
  retryDelay: 5 // Wait 5 seconds between retries
});
```


### `retryLimit`
**Type:** `number`
**Default:** `5`

Maximum number of retry attempts for failed message processing before marking the message as dead.

Set to `0` to disable retries.

```ts
EdgeWorker.start(handler, {
  retryLimit: 0 // retries are disabled
});
```

### `visibilityTimeout`
**Type:** `number`
**Default:** `3`

The duration (in seconds) that a message remains invisible to other consumers while being processed.

<Aside title="Timeouts" type="caution">
Set this value higher than your task's maximum expected processing time to prevent duplicate processing.
</Aside>

<Aside title="Work-in-Progress" type="danger">
This option will likely be refactored into `timeoutMs` to control both task timeouts and visibility timeouts.
**Consider this configuration unstable for now.**
</Aside>

```ts
EdgeWorker.start(handler, {
  visibilityTimeout: 5 // message will re-appear in queue after 5 seconds if not processed
});
```

## Concurrency

### `maxConcurrent`
**Type:** `number`
**Default:** `10`

This option limits concurrency - the maximum number of messages that can be processed at the same time.
Increase for IO-heavy tasks (network or db calls), decrease for CPU-heavy tasks.

```ts
EdgeWorker.start(handler, {
  maxConcurrent: 10 // Process up to 10 messages at once
});
```

### `maxPgConnections`
**Type:** `number`
**Default:** `4`

Maximum number of concurrent database connections.
Increase for IO-heavy tasks (network or database operations), decrease for CPU-heavy tasks.

```ts
EdgeWorker.start(handler, {
  maxPgConnections: 10 // Use up to 10 connections to the database
});
