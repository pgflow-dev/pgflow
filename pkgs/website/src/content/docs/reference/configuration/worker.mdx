---
title: Worker Configuration
description: Runtime settings for Edge Worker including concurrency, database connections, and polling behavior.
sidebar:
  order: 30
---

import { Aside } from "@astrojs/starlight/components";

These settings control how the Edge Worker processes tasks from your flows. They're passed when starting the worker and affect performance and resource utilization.

<Aside type="note">
Worker configuration requires redeploying your Edge Function to change, while flow/step configuration can be updated on the fly with SQL queries. See [Tune Deployed Flows](/deploy/tune-flow-config/) for details on updating configuration without redeployment.
</Aside>

## Default Worker Configuration

When using pgflow with Edge Worker, configure the worker's behavior:

```typescript
import { EdgeWorker } from '@pgflow/edge-worker';
import MyFlow from './flows/my_flow.ts';

EdgeWorker.start(MyFlow, {
  // Connection configuration (optional - see Connection Priority below)
  // connectionString: 'postgresql://...',
  // sql: customPostgresInstance,

  // Worker concurrency settings
  maxConcurrent: 10,      // Process up to 10 tasks simultaneously
  maxPgConnections: 4,    // Database connection pool size

  // Polling configuration
  batchSize: 10,          // Fetch up to 10 tasks per poll
  maxPollSeconds: 2,      // Long-poll duration
  pollIntervalMs: 100,    // Database polling frequency
});
```

## Connection Configuration

For local development, no configuration is needed - the worker auto-detects local Supabase and connects automatically. For production, see [Database Connection](/deploy/database-connection/) for setup options.

### `sql`
**Type:** `Sql` (postgres.js instance)
**Default:** `undefined`

A custom [postgres.js](https://github.com/porsager/postgres) connection instance. Use this for full control over connection options like SSL, connection pooling, or custom parameters.

```typescript
import postgres from 'postgres';

const sql = postgres('postgresql://...', {
  prepare: false,
  ssl: { ca: caCert, rejectUnauthorized: true },
});

EdgeWorker.start(MyFlow, { sql });
```

<Aside type="note">
When providing a custom `sql` instance, ensure `prepare: false` is set for compatibility with Supabase's transaction pooler.
</Aside>

### `connectionString`
**Type:** `string`
**Default:** `undefined`

Explicit database connection URL. Useful for preview branches or when you need to override the default connection.

```typescript
EdgeWorker.start(MyFlow, {
  connectionString: Deno.env.get('EDGE_WORKER_DB_URL')
    || Deno.env.get('SUPABASE_DB_URL'),
});
```

## Concurrency Configuration

### `maxConcurrent`
**Type:** `number`
**Default:** `10`

Maximum number of tasks that can be processed simultaneously. Increase for I/O-heavy tasks, decrease for CPU-heavy tasks.

### `maxPgConnections`
**Type:** `number`
**Default:** `4`

Size of the PostgreSQL connection pool. Should generally be less than `maxConcurrent` since not all tasks need a connection at all times.

## Polling Configuration

### `batchSize`
**Type:** `number`
**Default:** `10`

Maximum number of tasks to fetch in a single poll operation. Larger batches are more efficient but may lead to uneven work distribution.

### `maxPollSeconds`
**Type:** `number`
**Default:** `2`

How long to wait for tasks during each poll cycle. Shorter durations ensure more responsive task pickup.

<Aside type="caution">
Keep `maxPollSeconds` below the heartbeat interval (5 seconds) for flow workers to ensure proper heartbeat timing.
</Aside>

### `pollIntervalMs`
**Type:** `number`
**Default:** `100`

How frequently (in milliseconds) to check the database for new tasks during the poll cycle.

## Accessing Worker Configuration in Handlers

Your flow step handlers can access the resolved worker configuration through the context object. For detailed information about available configuration options and usage patterns, see [`workerConfig`](/reference/context/#workerconfig).

## Logging Configuration

Edge Worker automatically configures logging based on your environment, but you can override the defaults with environment variables.

### Environment Variables

#### `EDGE_WORKER_LOG_LEVEL`
**Type:** `'error' | 'warn' | 'info' | 'verbose' | 'debug'`

**Default:** `'verbose'` (local), `'info'` (hosted)

Controls log verbosity. The hierarchy is: error < warn < info < verbose < debug.

| Level | Description |
|-------|-------------|
| error | Critical failures only |
| warn | Deprecation notices, auth failures |
| info | Startup banner, shutdown (hosted default) |
| verbose | Task outcomes, polling feedback (local default) |
| debug | Task started events, identifiers (run_id, msg_id, worker_id) |

#### `EDGE_WORKER_LOG_FORMAT`
**Type:** `'fancy' | 'simple'`

**Default:** Auto-detected (`'fancy'` for local, `'simple'` for hosted)

- **fancy**: Colored output with icons, worker-prefixed lines, and human-readable formatting for local development
- **simple**: Structured `key=value` pairs for log aggregators in production

#### `NO_COLOR`
**Type:** `string` (any value)

**Default:** `undefined`

Set to any value to disable ANSI colors in fancy mode. Follows the [NO_COLOR standard](https://no-color.org/).

### Log Output Examples

**Fancy format (local development):**
```
➜ my-worker [abc123]
   Queue: my_flow
   Flows: ✓ myFlow (compiled)

my-worker: ✓ myFlow/fetchData  234ms
my-worker: ✗ myFlow/sendEmail
my-worker:   ValidationError: invalid email
my-worker:   ↻ retry 1/3 in 5s
```

**Simple format (production):**
```
[INFO] worker=my-worker queue=my_flow flow=myFlow status=compiled worker_id=abc123
[VERBOSE] worker=my-worker flow=myFlow step=fetchData status=completed duration_ms=234
[VERBOSE] worker=my-worker flow=myFlow step=sendEmail status=failed error="ValidationError: invalid email" retry=1/3 retry_delay_s=5
```

## Background Jobs Mode Differences

When using Edge Worker in [Background Jobs Mode](/get-started/faq/#what-are-the-two-edge-worker-modes) (without pgflow orchestration), there are a few key differences:

- **No flow/step configuration**: Queue workers don't have `maxAttempts`, `baseDelay`, `timeout`, or `startDelay` options in the flow definition. Instead, these are configured directly in the worker options.
- **`queueName` option**: Queue workers can specify a custom queue name (default is `tasks`), while flow workers automatically use the flow slug as the queue name.
- **Handler signature**: Queue workers receive a simple payload, while flow workers receive a context object with `input`, `run`, and previous step outputs.

For complete queue worker configuration, see [Queue Worker Configuration](/reference/queue-worker/configuration/).
