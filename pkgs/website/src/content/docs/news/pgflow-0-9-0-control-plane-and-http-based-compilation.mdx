---
draft: false
title: 'pgflow 0.9.0: Control Plane and HTTP-Based Compilation'
description: 'Simpler flow compilation via ControlPlane edge function - no local Deno required'
date: 2025-11-28
authors:
  - jumski
tags:
  - release
  - control-plane
  - compilation
featured: true
---

import { Aside } from "@astrojs/starlight/components";

pgflow 0.9.0 introduces the ControlPlane edge function, enabling HTTP-based flow compilation without requiring a local Deno installation.

## What Changed

The CLI no longer spawns Deno processes locally. Instead, compilation requests go through the ControlPlane edge function:

```
pgflow compile my_flow  -->  ControlPlane  -->  SQL migration
```

This simplifies the development setup and lays groundwork for future auto-compilation features where workers will verify and compile flows at startup without any CLI involvement.

<Aside type="note" title="Future Direction">
This release prepares for upcoming changes where edge workers will automatically verify flow shapes and trigger compilation when needed - making `pgflow compile` optional for development workflows.
</Aside>

## Breaking Changes

### Compile Command

The `pgflow compile` command now takes a **flow slug** instead of a file path:

**Before (0.8.x):**
```bash frame="none"
pgflow compile path/to/my_flow.ts --deno-json supabase/functions/deno.json
```

**After (0.9.0):**
```bash frame="none"
pgflow compile my_flow
```

The `--deno-json` flag has been removed.

<Aside type="tip" title="Need the Old Behavior?">
If you need local Deno compilation, you can use the previous version:

```bash frame="none"
npx pgflow@0.8.0 compile path/to/flow.ts
```
</Aside>

## New Install Experience

The installer now scaffolds a complete working setup:

```bash frame="none"
npx pgflow@0.9.0 install
```

This creates:
- `supabase/flows/` - Directory for flow definitions with namespace imports
- `supabase/flows/greet-user.ts` - Example GreetUser flow
- `supabase/functions/pgflow/` - Control Plane for compilation
- `supabase/functions/greet-user-worker/` - Example worker ready to run

The installer shows a clear summary and asks for a single confirmation before making changes.

## Namespace Imports for Flows

ControlPlane now supports namespace imports, the recommended pattern:

```typescript
import { ControlPlane } from '@pgflow/edge-worker';
import * as flows from '../../flows/index.ts';

ControlPlane.serve(flows);
```

Add flows by exporting from `flows/index.ts`:

```typescript
export { GreetUser } from './greet-user.ts';
export { MyOtherFlow } from './my-other-flow.ts';
```

## Upgrading from v0.8.x

**Existing compiled flows continue to work** - no recompilation needed.

To compile **new flows** with v0.9.0:

1. Run `npx pgflow@0.9.0 install` to add the ControlPlane and `supabase/flows/` directory
2. Create new flow files in `supabase/flows/`
3. Export them from `supabase/flows/index.ts`

<Aside type="note" title="Existing Flows">
You don't need to move existing flow files. The new structure is only for
flows you want to compile going forward. Move old flows only if you want
consistency in your project structure.
</Aside>

### Removed: --deno-json flag

The `--deno-json` flag has been removed. Compilation now uses the ControlPlane
edge function instead of local Deno. If you used this flag in CI/CD scripts,
update them to use the new compilation approach.
