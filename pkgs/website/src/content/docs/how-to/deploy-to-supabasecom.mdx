---
title: Deploy to Supabase.com
description: Learn how to deploy, manage and monitor Edge Worker on Supabase Background Tasks. Step-by-step guide for deployment, starting, and maintaining workers.
sidebar:
  order: 110
---

import { Aside, Steps } from "@astrojs/starlight/components";
import NotProductionReady from '../../../components/NotProductionReady.astro';

This guide walks through deploying Edge Workers to Supabase.com. The process currently involves a few manual steps to ensure smooth transitions - using pgflow's deprecation feature to stop old workers from accepting new work when deploying updates.

## Deployment Steps

<Steps>

1. **Deploy your new worker version**

   ```bash frame="none"
   npx supabase functions deploy your-worker-name
   ```

2. **Start the new worker**

   Make sure your flow migrations are already applied before starting:

   ```bash frame="none"
   curl -X POST "https://your-project.supabase.co/functions/v1/your-worker-name" \
     -H "Authorization: Bearer YOUR_ANON_KEY"
   ```

3. **Deprecate old workers**

   ```sql
   UPDATE pgflow.workers
   SET deprecated_at = NOW()
   WHERE function_name = 'your-worker-name'
     AND deprecated_at IS NULL;
   ```

4. **Monitor the transition** (optional)

   ```sql
   SELECT
     function_name,
     COUNT(*) FILTER (WHERE deprecated_at IS NULL) as active_workers,
     COUNT(*) FILTER (WHERE deprecated_at IS NOT NULL) as deprecated_workers
   FROM pgflow.workers
   WHERE last_heartbeat_at > now() - interval '6 seconds'
   GROUP BY function_name;
   ```

</Steps>

<details>
<summary>Why worker deprecation is needed</summary>

When you deploy a new version, old workers continue running until they hit resource limits (up to 150s on free tier, 400s on paid). This creates overlap where both versions process tasks simultaneously.

Worker deprecation solves this - deprecated workers stop accepting new work and complete their current tasks. Workers check their deprecation status every 5 seconds during heartbeat.

</details>

<details>
<summary>Getting your Authorization header</summary>

You need your project's ANON key for the Authorization header. Find it in your [Supabase Dashboard](https://supabase.com/dashboard) under Settings > API.

See Supabase docs: [Invoking remote functions](https://supabase.com/docs/guides/functions/deploy#invoking-remote-functions)

</details>

<NotProductionReady />

## Starting Workers

Just like in local development, workers are started with a simple HTTP request.
However, you need to pass Authorization header with your ANON_KEY when calling function.
Consult this Supabase Docs page for details: [Invoking remote functions](https://supabase.com/docs/guides/functions/deploy#invoking-remote-functions)

After the initial request, the worker will auto-respawn if terminated.

## Stopping Workers

To stop workers gracefully, use the deprecation mechanism described in the [deployment steps](#deployment-steps) above. Deprecated workers will stop accepting new work and complete their current tasks before shutting down.

## Ensuring Worker Availability

To ensure your worker stays active, it's recommended to use Cron to ping
your worker edge function every few seconds.
This is recommended in case there are any bugs in the respawn process,
which currently is triggered from withing the worker that is shutting down.

Use this Supabase guide [Invoking Supabase Function ever few seconds](https://supabase.com/docs/guides/cron/quickstart#invoke-supabase-edge-function-every-30-seconds).
but use `5 seconds` instead of `30 seconds`.

:::note
Make sure to **set your own ANON key** in the `Authorization` header!
:::
