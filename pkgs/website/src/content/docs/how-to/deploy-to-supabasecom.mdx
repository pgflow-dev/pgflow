---
title: Deploy to Supabase.com
description: Learn how to deploy, manage and monitor Edge Worker on Supabase Background Tasks. Step-by-step guide for deployment, starting, and maintaining workers.
sidebar:
  order: 110
---

import { Aside, Steps } from "@astrojs/starlight/components";
import NotProductionReady from '../../../components/NotProductionReady.astro';

pgflow workers are just regular Supabase Edge Functions running pgflow code. You deploy them exactly like any other Edge Function, with one extra step - deprecating old workers to stop processing new tasks.

## Deployment Steps

<Steps>

1. **Deploy your new worker version**

   ```bash frame="none"
   npx supabase functions deploy your-worker-name
   ```

2. **Start the new worker**

   Make sure your flow migrations are already applied before starting:

   ```bash frame="none"
   curl -X POST "https://your-project.supabase.co/functions/v1/your-worker-name" \
     -H "Authorization: Bearer YOUR_ANON_KEY"
   ```

3. **Deprecate old workers**

   ```sql
   UPDATE pgflow.workers
   SET deprecated_at = NOW()
   WHERE function_name = 'your-worker-name'
     AND deprecated_at IS NULL;
   ```

4. **Monitor the transition** (optional)

   ```sql
   SELECT
     function_name,
     COUNT(*) FILTER (WHERE deprecated_at IS NULL) as active_workers,
     COUNT(*) FILTER (WHERE deprecated_at IS NOT NULL) as deprecated_workers
   FROM pgflow.workers
   WHERE last_heartbeat_at > now() - interval '6 seconds'
   GROUP BY function_name;
   ```

</Steps>

<details>
<summary>Why worker deprecation is needed</summary>

When you deploy a new version, old workers continue running until they hit resource limits (up to 150s on free tier, 400s on paid). This creates overlap where both versions process tasks simultaneously.

Worker deprecation solves this - deprecated workers stop accepting new work and complete their current tasks. Workers check their deprecation status every 5 seconds during heartbeat.

</details>

<details>
<summary>Getting your Authorization header</summary>

You need your project's ANON key for the Authorization header. Find it in your [Supabase Dashboard](https://supabase.com/dashboard) under Settings > API.

See Supabase docs: [Invoking remote functions](https://supabase.com/docs/guides/functions/deploy#invoking-remote-functions)

</details>

<details>
<summary>Keeping workers running with pg_cron</summary>

Workers auto-respawn when terminated, but for extra reliability you can use pg_cron to ping your worker every 5 seconds:

```sql
SELECT cron.schedule(
  'ping-worker',
  '*/5 * * * * *',
  $$
  SELECT net.http_post(
    url := 'https://your-project.supabase.co/functions/v1/your-worker-name',
    headers := jsonb_build_object('Authorization', 'Bearer YOUR_ANON_KEY')
  ) AS request_id;
  $$
);
```

See [Supabase cron guide](https://supabase.com/docs/guides/cron/quickstart#invoke-supabase-edge-function-every-30-seconds) for details.

</details>

<NotProductionReady />
