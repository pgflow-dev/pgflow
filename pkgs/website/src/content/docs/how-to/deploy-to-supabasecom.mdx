---
title: Deploy to Supabase.com
description: Learn how to deploy, manage and monitor Edge Worker on Supabase Background Tasks. Step-by-step guide for deployment, starting, and maintaining workers.
sidebar:
  order: 110
---

import { Aside, Steps } from "@astrojs/starlight/components";
import NotProductionReady from '../../../components/NotProductionReady.astro';

pgflow workers are regular Supabase Edge Functions. Deploy them like any Edge Function, plus deprecate old workers to prevent version overlap.

<NotProductionReady />

## Quick Deployment

<Steps>

1. **Deprecate old workers**
   ```sql
   UPDATE pgflow.workers
   SET deprecated_at = NOW()
   WHERE function_name = 'your-worker-name'
     AND deprecated_at IS NULL;
   ```
   This stops old workers from polling for new tasks while they finish current work.

2. **Deploy new version**
   ```bash frame="none"
   npx supabase functions deploy your-worker-name
   ```

3. **Start new worker**
   ```bash frame="none"
   curl -X POST "https://your-project.supabase.co/functions/v1/your-worker-name" \
     -H "Authorization: Bearer YOUR_ANON_KEY"
   ```

</Steps>

## Deployment Details

### Why Worker Deprecation

Without deprecation, old workers run for up to 150s (free tier) or 400s (paid) after deployment, causing both versions to process tasks simultaneously.

Deprecation fixes this: workers check their status every 5 seconds and immediately stop polling for new tasks when deprecated, while finishing current work.

### Getting Your ANON Key

Find your ANON key in [Supabase Dashboard](https://supabase.com/dashboard) → Settings → API → `anon` `public` key.

### Monitoring Workers

Track deployment progress with this query:

```sql
SELECT
  function_name,
  COUNT(*) FILTER (WHERE deprecated_at IS NULL) as active_workers,
  COUNT(*) FILTER (WHERE deprecated_at IS NOT NULL) as deprecated_workers
FROM pgflow.workers
WHERE last_heartbeat_at > now() - interval '6 seconds'
GROUP BY function_name;
```

### Keeping Workers Running

Workers auto-respawn when terminated. For extra reliability, schedule a ping every 5 seconds:

```sql
SELECT cron.schedule(
  'ping-worker',
  '5 seconds',
  $$
  SELECT net.http_post(
    url := 'https://your-project.supabase.co/functions/v1/your-worker-name',
    headers := jsonb_build_object('Authorization', 'Bearer YOUR_ANON_KEY')
  ) AS request_id;
  $$
);
```

See [Supabase cron guide](https://supabase.com/docs/guides/cron/quickstart#invoke-supabase-edge-function-every-30-seconds) for details.
