---
title: Deploy to Supabase.com
description: Learn how to deploy, manage and monitor Edge Worker on Supabase Background Tasks. Step-by-step guide for deployment, starting, and maintaining workers.
sidebar:
  order: 110
---

import { Aside, Steps } from "@astrojs/starlight/components";
import NotProductionReady from '../../../components/NotProductionReady.astro';

pgflow workers are regular Supabase Edge Functions. Deploy them like any Edge Function, plus deprecate old workers to prevent version overlap.

<NotProductionReady />

## Prerequisites (First-Time Setup)

Before deploying workers to Supabase.com, ensure the following are configured:

1. **Database connection configured**

   Your `EDGE_WORKER_DB_URL` secret must be set up following the [Prepare DB Connection URL](/how-to/prepare-db-string/) guide.

   This involves:
   - Getting your Transaction Mode connection string from Supabase Dashboard
   - URL-encoding your database password
   - Replacing the password placeholder with the encoded password
   - Setting the final string in Supabase Secrets

   <Aside type="caution">
   This must be configured before your first deployment. Workers cannot start without a valid database connection.
   </Aside>

   Verify it's set:
   ```bash
   npx supabase secrets list | grep EDGE_WORKER_DB_URL
   ```

2. **Worker function created**

   Your Edge Function must be implemented at `supabase/functions/your-worker-name/index.ts`

## Quick Deployment

<Steps>

1. **Deprecate old workers**
   ```sql
   UPDATE pgflow.workers
   SET deprecated_at = NOW()
   WHERE function_name = 'your-worker-name'
     AND deprecated_at IS NULL;
   ```
   This stops old workers from polling for new tasks while they finish current work.

2. **Deploy new version**
   ```bash frame="none"
   npx supabase functions deploy your-worker-name
   ```

3. **Start new worker**
   ```bash frame="none"
   curl -X POST "https://your-project.supabase.co/functions/v1/your-worker-name" \
     -H "Authorization: Bearer YOUR_ANON_KEY"
   ```

4. **Keep workers up**
   
   [Set up the pg_cron safety net](/how-to/keep-workers-up/) for reliable production operation.
   
   <Aside type="danger" title="Don't Skip the Safety Net">
   **Your workers will eventually stop working without a safety net.** This is especially critical for production deployments where workflow reliability matters.

   The safety net takes 2 minutes to set up and prevents hours of debugging why workflows stopped running. [Configure it now →](/how-to/keep-workers-up/)
   </Aside>

</Steps>

## Deployment Details

### Why Worker Deprecation

Without deprecation, old workers run for up to 150s (free tier) or 400s (paid) after deployment, causing both versions to process tasks simultaneously.

Deprecation fixes this: workers check their status every 5 seconds and immediately stop polling for new tasks when deprecated, while finishing current work.

### Getting Your ANON Key

Find your ANON key in [Supabase Dashboard](https://supabase.com/dashboard) → Settings → API → `anon` `public` key.

### Monitoring Workers

Track deployment progress with this query:

```sql
SELECT
  function_name,
  COUNT(*) FILTER (WHERE deprecated_at IS NULL) as active_workers,
  COUNT(*) FILTER (WHERE deprecated_at IS NOT NULL) as deprecated_workers
FROM pgflow.workers
WHERE last_heartbeat_at > now() - interval '6 seconds'
GROUP BY function_name;
```

