---
title: Configure Secrets
description: Set up vault secrets for automatic worker management
sidebar:
  order: 15
---

import { Aside, Steps } from "@astrojs/starlight/components";

pgflow needs vault secrets to automatically manage workers in production.

<Steps>

1. ### Get your project ID

   <!-- SCREENSHOT PLACEHOLDER:
        Supabase Dashboard -> Project Settings -> General
        Highlight/arrow pointing to "Reference ID" field
        Show the alphanumeric project ID value
   -->

   1. Open [Supabase Dashboard](https://supabase.com/dashboard)
   2. Select your project
   3. Go to **Project Settings** -> **General**
   4. Copy the **Reference ID**

2. ### Get your service role key

   <!-- SCREENSHOT PLACEHOLDER:
        Supabase Dashboard -> Project Settings -> API
        Highlight/arrow pointing to service_role key (the secret one, not anon)
        Maybe blur/redact the actual key value for security
   -->

   1. Go to **Project Settings** -> **API**
   2. Under **Project API keys**, find `service_role` (labeled "secret")
   3. Click to reveal and copy the key

   <Aside type="caution">
   Keep this key secret - it bypasses Row Level Security.
   </Aside>

3. ### Create vault secrets

   Run in the SQL Editor:

   ```sql
   SELECT vault.create_secret('your-project-id', 'supabase_project_id');
   SELECT vault.create_secret('your-service-role-key', 'supabase_service_role_key');
   ```

   Replace with your actual values from steps 1 and 2.

</Steps>

## Troubleshooting

### Workers not starting automatically?

Verify vault secrets are configured:

```sql
SELECT name,
       CASE WHEN decrypted_secret IS NOT NULL THEN 'SET' ELSE 'MISSING' END as status
FROM vault.decrypted_secrets
WHERE name IN ('supabase_service_role_key', 'supabase_project_id');
```

Both should show `SET`.

### Test the cron manually

```sql
SELECT * FROM pgflow.ensure_workers();
```

Returns one row per worker function invoked. If empty but you have enabled workers:

1. Check secrets (query above)
2. Check registered workers: `SELECT * FROM pgflow.worker_functions WHERE enabled = true;`
