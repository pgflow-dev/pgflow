---
title: Update Deployed Flows
description: Safe workflow for deploying flow updates to production using worker deprecation
sidebar:
  order: 110
banner:
  content: |
    pgflow is in public beta. <a href="/project-status/">See project status</a> for production readiness details.
---

import { Aside, Steps } from "@astrojs/starlight/components";

When updating flows that are already deployed to production, use the deprecation workflow to prevent old and new worker versions from processing tasks simultaneously.

<Aside type="note" title="First Time Deployment?">
If you haven't deployed to production yet, see [Deploy Your First Flow](/deploy/supabase/deploy-first-flow/) for initial setup instructions.
</Aside>

## Update Workflow

<Steps>

1. **Deprecate old workers**
   ```sql
   UPDATE pgflow.workers
   SET deprecated_at = NOW()
   WHERE function_name = 'your-worker-name'
     AND deprecated_at IS NULL;
   ```
   This stops old workers from polling for new tasks while they finish current work.

2. **Deploy new version**
   ```bash frame="none"
   npx supabase functions deploy your-worker-name
   ```

3. **Wait for new worker to start**

   The pgflow cron automatically starts the new worker within seconds.

   See [Worker Management](/deploy/worker-management/) for details.

</Steps>

## Deployment Details

### Why Worker Deprecation

Without deprecation, old workers run for up to 150s (free tier) or 400s (paid) after deployment, causing both versions to process tasks simultaneously.

Deprecation fixes this: workers check their status every 5 seconds and immediately stop polling for new tasks when deprecated, while finishing current work.

### Monitoring Workers

Track deployment progress with this query:

```sql
SELECT
  function_name,
  COUNT(*) FILTER (WHERE deprecated_at IS NULL) as active_workers,
  COUNT(*) FILTER (WHERE deprecated_at IS NOT NULL) as deprecated_workers
FROM pgflow.workers
WHERE last_heartbeat_at > now() - interval '6 seconds'
GROUP BY function_name;
```

