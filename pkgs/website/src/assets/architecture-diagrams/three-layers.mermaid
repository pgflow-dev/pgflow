graph TD
    subgraph "Build-time"
      DSL[TypeScript DSL<br/>🧑‍💻 developer writes flows]
      DSL -->|`npx pgflow compile`| SQL[SQL migration]
    end
    subgraph "Run-time (inside Postgres)"
      CORE["SQL Core<br/>tables + functions"]
    end
    subgraph "Run-time (outside Postgres)"
      WORKER["Any Worker/Script<br/>(Edge Worker, cron, server etc.)"]
    end
    SQL --> CORE
    WORKER -->|1. poll_for_tasks| CORE
    WORKER <-->|2. complete_task / fail_task| CORE