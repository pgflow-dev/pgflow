graph TD
    subgraph "Build-time"
      DSL[TypeScript DSL]
      DSL -->|npx pgflow compile| SQL[SQL migration]
    end
    subgraph "Run-time (outside Postgres)"
      WORKER["Edge Worker"]
    end
    subgraph "Run-time (inside Postgres)"
      QUEUE["pgmq Queue"]
      CORE["SQL Core"]
    end
    SQL --> CORE
    WORKER -->|read_with_poll| QUEUE
    WORKER -->|start_tasks| CORE
    WORKER -->|complete_task or fail_task| CORE
    CORE -.->|enqueues| QUEUE
