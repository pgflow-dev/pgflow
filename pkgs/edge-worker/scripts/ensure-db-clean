#!/bin/bash
set -e

# Clean up any existing containers
echo "Shutting down existing clean database containers..."
docker compose -f tests/db-clean/compose.yaml down --volumes --remove-orphans

# Start fresh containers
echo "Starting clean database..."
docker compose -f tests/db-clean/compose.yaml up --detach

# Wait for database to be ready
echo "Waiting for database to be available..."
./scripts/wait-for-localhost 5433

# Additional pause to ensure database is fully initialized
echo "Waiting for database initialization..."
sleep 3

echo "Clean database is ready on port 5433!"
